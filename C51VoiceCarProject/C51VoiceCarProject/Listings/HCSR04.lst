C51 COMPILER V9.60.7.0   HCSR04                                                            03/21/2024 10:21:54 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE HCSR04
OBJECT MODULE PLACED IN .\Objects\HCSR04.obj
COMPILER INVOKED BY: D:\Keil C51\C51\BIN\C51.EXE HCSR04.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\HCS
                    -R04.lst) OBJECT(.\Objects\HCSR04.obj)

line level    source

   1          #include "HCSR04.h"
   2          
   3          /********************************变量定义****************************************/
   4          unsigned int time;
   5          float dis;
   6          
   7          /******************************************************************************/
   8          /* 函数名称  : HSCR04_Init                                                                        */
   9          /* 函数描述  : 初始化超声波测距，时间和距离                                                                       */    
  10          /* 输入参数  : 无                                                                 */
  11          /* 参数描述  : 无                                                                                     */
  12          /* 返回值    : 无                                                                         */
  13          /******************************************************************************/
  14          void HSCR04_Init()
  15          {
  16   1              time = 0;
  17   1              dis = 0.0;
  18   1      }
  19          
  20          /******************************************************************************/
  21          /* 函数名称  : Timer2_Init                                                                        */
  22          /* 函数描述  : 初始化定时器2，测时使用                                                                            */    
  23          /* 输入参数  : 无                                                                 */
  24          /* 参数描述  : 无                                                                                     */
  25          /* 返回值    : 无                                                                         */
  26          /******************************************************************************/
  27          void Timer2_Init()
  28          {
  29   1              T2CON = 0;
  30   1              TL2 = 0;                //设置定时初值
  31   1              TH2 = 0;                //设置定时初值
  32   1      }  
  33          
  34          /******************************************************************************/
  35          /* 函数名称  : Trig_Init                                                                  */
  36          /* 函数描述  : 超声波测距的触发条件                                                                                       */    
  37          /* 输入参数  : 无                                                                 */
  38          /* 参数描述  : 无                                                                                     */
  39          /* 返回值    : 无                                                                         */
  40          /******************************************************************************/
  41          void Trig_Init()
  42          {
  43   1              Trig = LOW;
  44   1              Trig = HIGH;
  45   1              Delay10us();
  46   1              Trig = LOW;
  47   1      }
  48          
  49          /******************************************************************************/
  50          /* 函数名称  : Start_Time                                                                 */
  51          /* 函数描述  : 开始计时初始化                                                                                             */    
  52          /* 输入参数  : 无                                                                 */
  53          /* 参数描述  : 无                                                                                     */
  54          /* 返回值    : 无                                                                         */
C51 COMPILER V9.60.7.0   HCSR04                                                            03/21/2024 10:21:54 PAGE 2   

  55          /******************************************************************************/
  56          void Start_Time()
  57          {
  58   1              TH2 = 0;
  59   1              TL2 = 0;
  60   1              TR2 = 1;
  61   1      }
  62          
  63          /******************************************************************************/
  64          /* 函数名称  : End_Time                                                                   */
  65          /* 函数描述  : 结束计时，关闭定时器2                                                                                      */    
  66          /* 输入参数  : 无                                                                 */
  67          /* 参数描述  : 无                                                                                     */
  68          /* 返回值    : 无                                                                         */
  69          /******************************************************************************/
  70          void End_Time()
  71          {
  72   1              TR2 = 0;
  73   1      }
  74          
  75          /******************************************************************************/
  76          /* 函数名称  : Get_Time                                                                   */
  77          /* 函数描述  : 计算超声波发射出去和反射回来所使用的时间                                           */    
  78          /* 输入参数  : 无                                                                 */
  79          /* 参数描述  : 无                                                                                     */
  80          /* 返回值    : 无                                                                         */
  81          /******************************************************************************/
  82          float Get_Time()
  83          {
  84   1              unsigned int time = 0;
  85   1              time = TH2 << 8 | TL2;
  86   1              return time;
  87   1      }
  88           
  89          /******************************************************************************/
  90          /* 函数名称  : Get_Dis                                                                            */
  91          /* 函数描述  : 通过声速340m/s,计算距离                                                                            */    
  92          /* 输入参数  : time                                                               */
  93          /* 参数描述  : 发射出去至反射回来的时间                                               */
  94          /* 返回值    : 距离                                                                       */
  95          /******************************************************************************/
  96          float Get_Dis( unsigned int time)
  97          {
  98   1              float dis;
  99   1              dis = (float)0.017 * time;
 100   1              return dis;
 101   1      }
 102          
 103          /******************************************************************************/
 104          /* 函数名称  : HCSR04_Distance                                                            */
 105          /* 函数描述  : 通过超声波测距模块计算前方距离障碍物的距离                                                 */    
 106          /* 输入参数  : 无                                                                 */
 107          /* 参数描述  : 无                                                                                     */
 108          /* 返回值    : 无                                                                         */
 109          /******************************************************************************/
 110          float HCSR04_Distance()
 111          {
 112   1               Trig_Init();
 113   1           while(Echo != 1);
 114   1           Start_Time();
 115   1               while(Echo != 0);
 116   1           End_Time();
C51 COMPILER V9.60.7.0   HCSR04                                                            03/21/2024 10:21:54 PAGE 3   

 117   1           time = Get_Time();
 118   1           dis = Get_Dis(time);
 119   1              return dis;
 120   1      }
 121           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    131    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
